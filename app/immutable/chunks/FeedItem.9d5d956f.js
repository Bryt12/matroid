import{s as Y,f as v,a as K,g as _,h as b,c as M,d as m,j as S,i as H,v as p,o as x,l as Z,m as z,L as pe,n as Q,p as me,k as B,w as W}from"./scheduler.d64e95b5.js";import{S as ee,i as te,b as N,d as F,m as O,a as w,t as $,e as j,g as de,c as he}from"./index.63c1aa50.js";import{B as X,P as ge}from"./Button.e388db07.js";import{l as ve,a as _e,b as be}from"./nostr.9a7871d3.js";function Fe(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function ke(l,e={}){const{threshold:s=.1,root:t=null,rootMargin:n="0px"}=e||{};let o=!1;function c(d){d.forEach(r=>{r.isIntersecting!==o&&(o=r.isIntersecting,l.dispatchEvent(new CustomEvent("visible",{detail:{inView:o}})))})}const f=new IntersectionObserver(c,{threshold:s,root:t,rootMargin:n});return f.observe(l),{destroy(){f.disconnect()}}}function ye(l){var d;let e,s,t,n,o,c,f;return s=new X({props:{symbol:"ξ",pillLabel:"Seed",pillValue:String(l[1]),onClick:l[3]}}),n=new X({props:{symbol:"♥",pillLabel:"Likes",pillValue:String((d=l[0])==null?void 0:d.likes),onClick:l[4],selectColor:"#f54284",active:l[2],disabled:l[0].likeEvent===void 0}}),c=new X({props:{symbol:"⚡",pillLabel:"Zaps",pillValue:"0 sats",onClick:Ee}}),{c(){e=v("div"),N(s.$$.fragment),t=K(),N(n.$$.fragment),o=K(),N(c.$$.fragment),this.h()},l(r){e=_(r,"DIV",{class:!0});var i=b(e);F(s.$$.fragment,i),t=M(i),F(n.$$.fragment,i),o=M(i),F(c.$$.fragment,i),i.forEach(m),this.h()},h(){S(e,"class","button-container svelte-drm4fo")},m(r,i){H(r,e,i),O(s,e,null),p(e,t),O(n,e,null),p(e,o),O(c,e,null),f=!0},p(r,[i]){var E;const a={};i&2&&(a.pillValue=String(r[1])),s.$set(a);const g={};i&1&&(g.pillValue=String((E=r[0])==null?void 0:E.likes)),i&4&&(g.active=r[2]),i&1&&(g.disabled=r[0].likeEvent===void 0),n.$set(g)},i(r){f||(w(s.$$.fragment,r),w(n.$$.fragment,r),w(c.$$.fragment,r),f=!0)},o(r){$(s.$$.fragment,r),$(n.$$.fragment,r),$(c.$$.fragment,r),f=!1},d(r){r&&m(e),j(s),j(n),j(c)}}}const Ee=()=>{};function Se(l,e,s){let t,{changeSeed:n}=e,{post:o}=e,{seed:c}=e,f;x(async()=>{s(6,f=await window.nostr.getPublicKey())});function d(){n(Math.floor(Math.random()*1e5))}function r(){ve(o.publicKey,o.id)}return l.$$set=i=>{"changeSeed"in i&&s(5,n=i.changeSeed),"post"in i&&s(0,o=i.post),"seed"in i&&s(1,c=i.seed)},l.$$.update=()=>{var i;l.$$.dirty&65&&s(2,t=(i=o==null?void 0:o.likeEvent)==null?void 0:i.some(a=>a.pubkey===f))},[o,c,t,d,r,n,f]}class we extends ee{constructor(e){super(),te(this,e,Se,ye,Y,{changeSeed:5,post:0,seed:1})}}function $e(l){let e;return{c(){e=v("div"),this.h()},l(s){e=_(s,"DIV",{style:!0}),b(e).forEach(m),this.h()},h(){B(e,"width","400px"),B(e,"height","400px"),B(e,"background-color","#f0f0f0"),B(e,"border-radius","10px")},m(s,t){H(s,e,t)},p:W,i:W,o:W,d(s){s&&m(e)}}}function Ve(l){let e,s;return e=new ge({props:{title:l[0].title,sketch:l[0].sketch,width:400,height:400,seed:l[4]}}),{c(){N(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,n){O(e,t,n),s=!0},p(t,n){const o={};n&1&&(o.title=t[0].title),n&1&&(o.sketch=t[0].sketch),n&16&&(o.seed=t[4]),e.$set(o)},i(t){s||(w(e.$$.fragment,t),s=!0)},o(t){$(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function De(l){let e,s,t,n,o=l[0].title+"",c,f,d,r,i,a,g,E,V,k,y,J,D,R,A,q,G,I,U,ne;const se=[Ve,$e],L=[];function le(u,h){return u[3]?0:1}return k=le(l),y=L[k]=se[k](l),D=new we({props:{changeSeed:l[6],post:l[0],seed:l[4]}}),{c(){e=v("div"),s=v("div"),t=v("div"),n=v("span"),c=Z(o),f=K(),d=v("a"),r=v("span"),i=Z(l[5]),g=K(),E=v("div"),V=v("div"),y.c(),J=K(),N(D.$$.fragment),R=K(),A=v("div"),q=v("span"),G=Z(l[2]),this.h()},l(u){e=_(u,"DIV",{class:!0});var h=b(e);s=_(h,"DIV",{class:!0});var C=b(s);t=_(C,"DIV",{class:!0});var P=b(t);n=_(P,"SPAN",{class:!0});var oe=b(n);c=z(oe,o),oe.forEach(m),f=M(P),d=_(P,"A",{href:!0,class:!0});var re=b(d);r=_(re,"SPAN",{});var ie=b(r);i=z(ie,l[5]),ie.forEach(m),re.forEach(m),P.forEach(m),C.forEach(m),g=M(h),E=_(h,"DIV",{class:!0});var T=b(E);V=_(T,"DIV",{});var ae=b(V);y.l(ae),ae.forEach(m),J=M(T),F(D.$$.fragment,T),T.forEach(m),R=M(h),A=_(h,"DIV",{class:!0});var ce=b(A);q=_(ce,"SPAN",{});var ue=b(q);G=z(ue,l[2]),ue.forEach(m),ce.forEach(m),h.forEach(m),this.h()},h(){S(n,"class","title svelte-5nkysu"),S(d,"href",a=`/profile/${l[0].publicKey}`),S(d,"class","username svelte-5nkysu"),S(t,"class","header-text svelte-5nkysu"),S(s,"class","header"),S(E,"class","post-section svelte-5nkysu"),S(A,"class","footer svelte-5nkysu"),S(e,"class","post svelte-5nkysu")},m(u,h){H(u,e,h),p(e,s),p(s,t),p(t,n),p(n,c),p(t,f),p(t,d),p(d,r),p(r,i),p(e,g),p(e,E),p(E,V),L[k].m(V,null),l[7](V),p(E,J),O(D,E,null),p(e,R),p(e,A),p(A,q),p(q,G),I=!0,U||(ne=pe(ke.call(null,V,{threshold:0})),U=!0)},p(u,[h]){(!I||h&1)&&o!==(o=u[0].title+"")&&Q(c,o),(!I||h&32)&&Q(i,u[5]),(!I||h&1&&a!==(a=`/profile/${u[0].publicKey}`))&&S(d,"href",a);let C=k;k=le(u),k===C?L[k].p(u,h):(de(),$(L[C],1,1,()=>{L[C]=null}),he(),y=L[k],y?y.p(u,h):(y=L[k]=se[k](u),y.c()),w(y,1),y.m(V,null));const P={};h&1&&(P.post=u[0]),h&16&&(P.seed=u[4]),D.$set(P),(!I||h&4)&&Q(G,u[2])},i(u){I||(w(y),w(D.$$.fragment,u),I=!0)},o(u){$(y),$(D.$$.fragment,u),I=!1},d(u){u&&m(e),L[k].d(),l[7](null),j(D),U=!1,ne()}}}function Ie(l,e,s){let t,{post:n}=e,o,c,f=!1,d=n==null?void 0:n.seeds[0];x(()=>{const a=g=>{s(3,f=g.detail.inView)};return o.addEventListener("visible",a),()=>{o.removeEventListener("visible",a)}});function r(a){s(4,d=a)}function i(a){me[a?"unshift":"push"](()=>{o=a,s(1,o)})}return l.$$set=a=>{"post"in a&&s(0,n=a.post)},l.$$.update=()=>{var a;if(l.$$.dirty&1&&n!=null&&n.createdAt){let g=new Date(n.createdAt*1e3);s(2,c=g.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}))}l.$$.dirty&1&&s(5,t=((a=n==null?void 0:n.author)==null?void 0:a.name)||n.publicKey)},[n,o,c,f,d,t,r,i]}class Le extends ee{constructor(e){super(),te(this,e,Ie,De,Y,{post:0})}}function Pe(l,e){for(const s of l)if(s[0]===e)return s[1];return""}function fe(l){let e,s;return e=new Le({props:{post:l[0]}}),{c(){N(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,n){O(e,t,n),s=!0},p(t,n){const o={};n&1&&(o.post=t[0]),e.$set(o)},i(t){s||(w(e.$$.fragment,t),s=!0)},o(t){$(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Ae(l){let e,s,t=l[0]&&fe(l);return{c(){e=v("div"),t&&t.c(),this.h()},l(n){e=_(n,"DIV",{class:!0,style:!0});var o=b(e);t&&t.l(o),o.forEach(m),this.h()},h(){var n;S(e,"class","post svelte-fc6pac"),B(e,"--bg-color",(n=l[0])==null?void 0:n.color)},m(n,o){H(n,e,o),t&&t.m(e,null),s=!0},p(n,[o]){var c;n[0]?t?(t.p(n,o),o&1&&w(t,1)):(t=fe(n),t.c(),w(t,1),t.m(e,null)):t&&(de(),$(t,1,1,()=>{t=null}),he()),(!s||o&1)&&B(e,"--bg-color",(c=n[0])==null?void 0:c.color)},i(n){s||(w(t),s=!0)},o(n){$(t),s=!1},d(n){n&&m(e),t&&t.d()}}}function Ce(l,e,s){let{event:t}=e,n;x(async()=>{try{o()}catch(r){console.error(r)}});async function o(){c();const[r,i]=await Promise.all([_e(t.pubkey),be(t.id)]);f(r),d(i)}function c(){let r=JSON.parse(t.content);s(0,n={id:t.id,...r,publicKey:t.pubkey,color:Pe(t.tags,"c"),createdAt:t.created_at})}function f(r){s(0,n.author=r,n)}function d(r){let i=0;const a=new Set;r.forEach(g=>{a.has(g.pubkey)||(i++,a.add(g.pubkey))}),s(0,n.likes=i,n),s(0,n.likeEvent=r,n)}return l.$$set=r=>{"event"in r&&s(1,t=r.event)},[n,t]}class Oe extends ee{constructor(e){super(),te(this,e,Ce,Ae,Y,{event:1})}}export{Oe as F,Fe as e};
