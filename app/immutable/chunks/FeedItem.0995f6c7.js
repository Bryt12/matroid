import{s as Y,f as g,a as B,g as v,h as _,c as N,d as m,j as y,i as H,v as p,o as Z,l as z,m as Q,L as pe,n as W,p as me,k as K,w as X}from"./scheduler.d64e95b5.js";import{S as x,i as ee,b as F,d as O,m as j,a as S,t as w,e as q,g as de,c as he}from"./index.63c1aa50.js";import{B as ue,P as ge}from"./Button.e388db07.js";import{l as ve,a as _e,b as be}from"./nostr.9a7871d3.js";function Ne(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function ke(l,t={}){const{threshold:s=.1,root:e=null,rootMargin:n="0px"}=t||{};let o=!1;function d(i){i.forEach(a=>{a.isIntersecting!==o&&(o=a.isIntersecting,l.dispatchEvent(new CustomEvent("visible",{detail:{inView:o}})))})}const r=new IntersectionObserver(d,{threshold:s,root:e,rootMargin:n});return r.observe(l),{destroy(){r.disconnect()}}}function ye(l){var d;let t,s,e,n,o;return s=new ue({props:{symbol:"ξ",pillLabel:"Seed",pillValue:String(l[1]),onClick:l[3]}}),n=new ue({props:{symbol:"♥",pillLabel:"Likes",pillValue:String((d=l[0])==null?void 0:d.likes),onClick:l[4],selectColor:"#f54284",active:l[2],disabled:l[0].likeEvent===void 0}}),{c(){t=g("div"),F(s.$$.fragment),e=B(),F(n.$$.fragment),this.h()},l(r){t=v(r,"DIV",{class:!0});var i=_(t);O(s.$$.fragment,i),e=N(i),O(n.$$.fragment,i),i.forEach(m),this.h()},h(){y(t,"class","button-container svelte-drm4fo")},m(r,i){H(r,t,i),j(s,t,null),p(t,e),j(n,t,null),o=!0},p(r,[i]){var u;const a={};i&2&&(a.pillValue=String(r[1])),s.$set(a);const c={};i&1&&(c.pillValue=String((u=r[0])==null?void 0:u.likes)),i&4&&(c.active=r[2]),i&1&&(c.disabled=r[0].likeEvent===void 0),n.$set(c)},i(r){o||(S(s.$$.fragment,r),S(n.$$.fragment,r),o=!0)},o(r){w(s.$$.fragment,r),w(n.$$.fragment,r),o=!1},d(r){r&&m(t),q(s),q(n)}}}function Ee(l,t,s){let e,{changeSeed:n}=t,{post:o}=t,{seed:d}=t,r;Z(async()=>{s(6,r=await window.nostr.getPublicKey())});function i(){n(Math.floor(Math.random()*1e5))}function a(){ve(o.publicKey,o.id)}return l.$$set=c=>{"changeSeed"in c&&s(5,n=c.changeSeed),"post"in c&&s(0,o=c.post),"seed"in c&&s(1,d=c.seed)},l.$$.update=()=>{var c;l.$$.dirty&65&&s(2,e=(c=o==null?void 0:o.likeEvent)==null?void 0:c.some(u=>u.pubkey===r))},[o,d,e,i,a,n,r]}class Se extends x{constructor(t){super(),ee(this,t,Ee,ye,Y,{changeSeed:5,post:0,seed:1})}}function we(l){let t;return{c(){t=g("div"),this.h()},l(s){t=v(s,"DIV",{style:!0}),_(t).forEach(m),this.h()},h(){K(t,"width","400px"),K(t,"height","400px"),K(t,"background-color","#f0f0f0"),K(t,"border-radius","10px")},m(s,e){H(s,t,e)},p:X,i:X,o:X,d(s){s&&m(t)}}}function Ve(l){let t,s;return t=new ge({props:{title:l[0].title,sketch:l[0].sketch,width:400,height:400,seed:l[4]}}),{c(){F(t.$$.fragment)},l(e){O(t.$$.fragment,e)},m(e,n){j(t,e,n),s=!0},p(e,n){const o={};n&1&&(o.title=e[0].title),n&1&&(o.sketch=e[0].sketch),n&16&&(o.seed=e[4]),t.$set(o)},i(e){s||(S(t.$$.fragment,e),s=!0)},o(e){w(t.$$.fragment,e),s=!1},d(e){q(t,e)}}}function De(l){let t,s,e,n,o=l[0].title+"",d,r,i,a,c,u,E,V,D,b,k,J,I,R,$,M,G,P,U,te;const ne=[Ve,we],A=[];function se(f,h){return f[3]?0:1}return b=se(l),k=A[b]=ne[b](l),I=new Se({props:{changeSeed:l[6],post:l[0],seed:l[4]}}),{c(){t=g("div"),s=g("div"),e=g("div"),n=g("span"),d=z(o),r=B(),i=g("a"),a=g("span"),c=z(l[5]),E=B(),V=g("div"),D=g("div"),k.c(),J=B(),F(I.$$.fragment),R=B(),$=g("div"),M=g("span"),G=z(l[2]),this.h()},l(f){t=v(f,"DIV",{class:!0});var h=_(t);s=v(h,"DIV",{class:!0});var C=_(s);e=v(C,"DIV",{class:!0});var L=_(e);n=v(L,"SPAN",{class:!0});var le=_(n);d=Q(le,o),le.forEach(m),r=N(L),i=v(L,"A",{href:!0,class:!0});var oe=_(i);a=v(oe,"SPAN",{});var re=_(a);c=Q(re,l[5]),re.forEach(m),oe.forEach(m),L.forEach(m),C.forEach(m),E=N(h),V=v(h,"DIV",{class:!0});var T=_(V);D=v(T,"DIV",{});var ie=_(D);k.l(ie),ie.forEach(m),J=N(T),O(I.$$.fragment,T),T.forEach(m),R=N(h),$=v(h,"DIV",{class:!0});var ae=_($);M=v(ae,"SPAN",{});var ce=_(M);G=Q(ce,l[2]),ce.forEach(m),ae.forEach(m),h.forEach(m),this.h()},h(){y(n,"class","title svelte-5nkysu"),y(i,"href",u=`/profile/${l[0].publicKey}`),y(i,"class","username svelte-5nkysu"),y(e,"class","header-text svelte-5nkysu"),y(s,"class","header"),y(V,"class","post-section svelte-5nkysu"),y($,"class","footer svelte-5nkysu"),y(t,"class","post svelte-5nkysu")},m(f,h){H(f,t,h),p(t,s),p(s,e),p(e,n),p(n,d),p(e,r),p(e,i),p(i,a),p(a,c),p(t,E),p(t,V),p(V,D),A[b].m(D,null),l[7](D),p(V,J),j(I,V,null),p(t,R),p(t,$),p($,M),p(M,G),P=!0,U||(te=pe(ke.call(null,D,{threshold:0})),U=!0)},p(f,[h]){(!P||h&1)&&o!==(o=f[0].title+"")&&W(d,o),(!P||h&32)&&W(c,f[5]),(!P||h&1&&u!==(u=`/profile/${f[0].publicKey}`))&&y(i,"href",u);let C=b;b=se(f),b===C?A[b].p(f,h):(de(),w(A[C],1,1,()=>{A[C]=null}),he(),k=A[b],k?k.p(f,h):(k=A[b]=ne[b](f),k.c()),S(k,1),k.m(D,null));const L={};h&1&&(L.post=f[0]),h&16&&(L.seed=f[4]),I.$set(L),(!P||h&4)&&W(G,f[2])},i(f){P||(S(k),S(I.$$.fragment,f),P=!0)},o(f){w(k),w(I.$$.fragment,f),P=!1},d(f){f&&m(t),A[b].d(),l[7](null),q(I),U=!1,te()}}}function Ie(l,t,s){let e,{post:n}=t,o,d,r=!1,i=n==null?void 0:n.seeds[0];Z(()=>{const u=E=>{s(3,r=E.detail.inView)};return o.addEventListener("visible",u),()=>{o.removeEventListener("visible",u)}});function a(u){s(4,i=u)}function c(u){me[u?"unshift":"push"](()=>{o=u,s(1,o)})}return l.$$set=u=>{"post"in u&&s(0,n=u.post)},l.$$.update=()=>{var u;if(l.$$.dirty&1&&n!=null&&n.createdAt){let E=new Date(n.createdAt*1e3);s(2,d=E.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}))}l.$$.dirty&1&&s(5,e=((u=n==null?void 0:n.author)==null?void 0:u.name)||n.publicKey)},[n,o,d,r,i,e,a,c]}class Pe extends x{constructor(t){super(),ee(this,t,Ie,De,Y,{post:0})}}function Ae(l,t){for(const s of l)if(s[0]===t)return s[1];return""}function fe(l){let t,s;return t=new Pe({props:{post:l[0]}}),{c(){F(t.$$.fragment)},l(e){O(t.$$.fragment,e)},m(e,n){j(t,e,n),s=!0},p(e,n){const o={};n&1&&(o.post=e[0]),t.$set(o)},i(e){s||(S(t.$$.fragment,e),s=!0)},o(e){w(t.$$.fragment,e),s=!1},d(e){q(t,e)}}}function Le(l){let t,s,e=l[0]&&fe(l);return{c(){t=g("div"),e&&e.c(),this.h()},l(n){t=v(n,"DIV",{class:!0,style:!0});var o=_(t);e&&e.l(o),o.forEach(m),this.h()},h(){var n;y(t,"class","post svelte-fc6pac"),K(t,"--bg-color",(n=l[0])==null?void 0:n.color)},m(n,o){H(n,t,o),e&&e.m(t,null),s=!0},p(n,[o]){var d;n[0]?e?(e.p(n,o),o&1&&S(e,1)):(e=fe(n),e.c(),S(e,1),e.m(t,null)):e&&(de(),w(e,1,1,()=>{e=null}),he()),(!s||o&1)&&K(t,"--bg-color",(d=n[0])==null?void 0:d.color)},i(n){s||(S(e),s=!0)},o(n){w(e),s=!1},d(n){n&&m(t),e&&e.d()}}}function $e(l,t,s){let{event:e}=t,n;Z(async()=>{try{o()}catch(a){console.error(a)}});async function o(){d();const[a,c]=await Promise.all([_e(e.pubkey),be(e.id)]);r(a),i(c)}function d(){let a=JSON.parse(e.content);s(0,n={id:e.id,...a,publicKey:e.pubkey,color:Ae(e.tags,"c"),createdAt:e.created_at})}function r(a){s(0,n.author=a,n)}function i(a){let c=0;const u=new Set;a.forEach(E=>{u.has(E.pubkey)||(c++,u.add(E.pubkey))}),s(0,n.likes=c,n),s(0,n.likeEvent=a,n)}return l.$$set=a=>{"event"in a&&s(1,e=a.event)},[n,e]}class Fe extends x{constructor(t){super(),ee(this,t,$e,Le,Y,{event:1})}}export{Fe as F,Ne as e};
